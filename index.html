<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wasteland Survival RPG</title>
    <style>
        body {
            font-family: 'Courier New', Courier, monospace;
            background-color: #121212;
            color: #33ff33;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
        }
        #game-container {
            max-width: 500px;
            width: 100%;
            background: #000;
            border: 2px solid #33ff33;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 0 15px rgba(51, 255, 51, 0.2);
        }
        .status-bar {
            border-bottom: 1px dashed #33ff33;
            padding-bottom: 10px;
            margin-bottom: 15px;
            font-size: 0.9em;
        }
        .status-row {
            display: flex;
            justify-content: space-between;
            margin: 4px 0;
        }
        #game-log {
            height: 250px;
            overflow-y: auto;
            border: 1px solid #333;
            background: #0a0a0a;
            padding: 10px;
            margin-bottom: 15px;
            font-size: 0.9em;
            line-height: 1.4;
        }
        .log-entry { margin-bottom: 8px; }
        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }
        button {
            background-color: #33ff33;
            color: #000;
            border: none;
            padding: 12px;
            font-size: 1em;
            font-weight: bold;
            font-family: inherit;
            cursor: pointer;
            border-radius: 4px;
            flex: 1;
            min-width: 100px;
        }
        button:hover { background-color: #29cc29; }
        button:disabled { background-color: #555; color: #222; cursor: not-allowed; }
        
        .sys-btn {
            background-color: #555;
            color: #fff;
            padding: 8px;
            font-size: 0.85em;
        }
        .sys-btn:hover { background-color: #777; }

        #inventory-panel {
            display: none;
            border: 1px solid #33ff33;
            padding: 10px;
            margin-top: 10px;
            background: #111;
        }
        .inv-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #333;
            padding: 8px 0;
            font-size: 0.85em;
        }
        .inv-btn {
            padding: 5px 10px;
            font-size: 0.8em;
            flex: none;
            margin-left: 10px;
        }
    </style>
</head>
<body>

<div id="game-container">
    <div class="status-bar">
        <div class="status-row">
            <span id="stat-name">Survivor</span>
            <span id="stat-level">Lvl: 1</span>
        </div>
        <div class="status-row">
            <span id="stat-hp">HP: 100/100</span>
            <span id="stat-xp">XP: 0/50</span>
        </div>
        <div class="status-row">
            <span id="stat-weapon">Wep: Fists</span>
            <span id="stat-armor">Arm: Clothes</span>
        </div>
    </div>

    <div id="game-log"></div>

    <div class="controls" id="main-controls">
        <button id="btn-explore" onclick="explore()">Explore</button>
        <button id="btn-inventory" onclick="toggleInventory()">Inventory</button>
    </div>
    
    <div class="controls" id="combat-controls" style="display: none;">
        <button id="btn-attack" onclick="attack()">Attack</button>
        <button id="btn-flee" onclick="flee()">Flee</button>
    </div>

    <div class="controls" id="sys-controls" style="margin-top: 15px; border-top: 1px dashed #333; padding-top: 15px;">
        <button class="sys-btn" onclick="saveGame()">Save Game</button>
        <button class="sys-btn" onclick="loadGame()">Load Game</button>
    </div>

    <div id="inventory-panel">
        <div style="display:flex; justify-content:space-between; margin-bottom: 10px;">
            <strong>Your Items</strong>
            <button class="inv-btn" onclick="toggleInventory()" style="background:#ff3333; color:white;">Close</button>
        </div>
        <div id="inventory-list"></div>
    </div>
</div>

<script>
    // ==========================================
    // CLASSES
    // ==========================================
    class Item {
        constructor(name, desc, type, power) {
            this.name = name;
            this.desc = desc;
            this.type = type; 
            this.power = power;
        }
    }

    class Entity {
        constructor(name, hp, baseAttack) {
            this.name = name;
            this.hp = hp;
            this.maxHp = hp;
            this.baseAttack = baseAttack;
        }
        isAlive() { return this.hp > 0; }
    }

    class Player extends Entity {
        constructor(name) {
            super(name, 100, 15);
            this.level = 1;
            this.xp = 0;
            this.xpToLevel = 50;
            this.inventory = [];
            this.weapon = null;
            this.armor = null;
        }

        get totalAttack() { return this.baseAttack + (this.weapon ? this.weapon.power : 0); }
        get totalDefense() { return this.armor ? this.armor.power : 0; }

        takeDamage(damage) {
            let actualDamage = damage - this.totalDefense;
            if (actualDamage < 1) actualDamage = 1;
            this.hp -= actualDamage;
            if (this.hp < 0) this.hp = 0;
            return actualDamage;
        }

        heal(amount) {
            this.hp += amount;
            if (this.hp > this.maxHp) this.hp = this.maxHp;
            log(`You healed! Current HP: ${this.hp}/${this.maxHp}`, "#33ff33");
        }

        gainXp(amount) {
            this.xp += amount;
            log(`You gained ${amount} XP!`);
            if (this.xp >= this.xpToLevel) this.levelUp();
        }

        levelUp() {
            this.level++;
            this.xp -= this.xpToLevel;
            this.xpToLevel = Math.floor(this.xpToLevel * 1.5);
            this.maxHp += 20;
            this.hp = this.maxHp;
            this.baseAttack += 5;
            log(`*** LEVEL UP! You are now Level ${this.level} ***`, "#ffff33");
            log(`Base Stats increased! Max HP: ${this.maxHp} | Base Attack: ${this.baseAttack}`);
        }
    }

    class Enemy extends Entity {
        constructor(name, hp, baseAttack, xpReward) {
            super(name, hp, baseAttack);
            this.xpReward = xpReward;
        }
        takeDamage(damage) {
            this.hp -= damage;
            if (this.hp < 0) this.hp = 0;
        }
    }

    // ==========================================
    // GAME STATE & DATA
    // ==========================================
    const player = new Player("Survivor");
    let currentEnemy = null;
    let gameState = 'EXPLORE'; 

    const possibleItems = [
        new Item("Dirty Bandage", "Heals 15 HP.", "heal", 15),
        new Item("Canned Beans", "Heals 30 HP.", "heal", 30),
        new Item("First Aid Kit", "Heals 60 HP.", "heal", 60),
        new Item("Rusty Pipe", "Weapon.", "weapon", 5),
        new Item("Machete", "Weapon.", "weapon", 12),
        new Item("Leather Jacket", "Armor.", "armor", 3),
        new Item("Scrap Armor", "Armor.", "armor", 8)
    ];

    const possibleEnemies = [
        { name: "Mutant Hound", hp: 30, atk: 8, xp: 20 },
        { name: "Wasteland Scavenger", hp: 50, atk: 12, xp: 35 },
        { name: "Rad-Bear", hp: 80, atk: 18, xp: 60 }
    ];

    // ==========================================
    // UI FUNCTIONS
    // ==========================================
    function log(message, color = "#33ff33") {
        const logDiv = document.getElementById("game-log");
        const entry = document.createElement("div");
        entry.className = "log-entry";
        entry.style.color = color;
        entry.innerHTML = message;
        logDiv.appendChild(entry);
        logDiv.scrollTop = logDiv.scrollHeight; 
    }

    function updateUI() {
        document.getElementById("stat-level").innerText = `Lvl: ${player.level}`;
        document.getElementById("stat-hp").innerText = `HP: ${player.hp}/${player.maxHp}`;
        document.getElementById("stat-xp").innerText = `XP: ${player.xp}/${player.xpToLevel}`;
        document.getElementById("stat-weapon").innerText = `Wep: ${player.weapon ? player.weapon.name : "Fists"}`;
        document.getElementById("stat-armor").innerText = `Arm: ${player.armor ? player.armor.name : "Clothes"}`;

        if (gameState === 'COMBAT') {
            document.getElementById("main-controls").style.display = "none";
            document.getElementById("combat-controls").style.display = "flex";
            document.getElementById("inventory-panel").style.display = "none";
            document.getElementById("sys-controls").style.display = "none"; // Hide save/load during combat
        } else {
            document.getElementById("main-controls").style.display = "flex";
            document.getElementById("combat-controls").style.display = "none";
            document.getElementById("sys-controls").style.display = "flex";
        }
        
        if (!player.isAlive()) {
            document.getElementById("main-controls").innerHTML = `<button onclick="location.reload()">Restart Game</button>`;
            document.getElementById("sys-controls").style.display = "none";
        }
    }

    // ==========================================
    // GAME LOGIC
    // ==========================================
    function explore() {
        log("------------------------------------");
        log("You venture out into the wasteland...");
        const event = Math.floor(Math.random() * 10) + 1;

        if (event <= 4) {
            const template = possibleEnemies[Math.floor(Math.random() * possibleEnemies.length)];
            const eHp = template.hp + (player.level * 5);
            const eAtk = template.atk + (player.level * 2);
            const eXp = template.xp + (player.level * 10);
            
            currentEnemy = new Enemy(template.name, eHp, eAtk, eXp);
            gameState = 'COMBAT';
            log(`A wild ${currentEnemy.name} appears! (HP: ${currentEnemy.hp})`, "#ff3333");
        } else if (event <= 8) {
            const item = possibleItems[Math.floor(Math.random() * possibleItems.length)];
            player.inventory.push(item);
            log(`You found a ${item.name}! (${item.desc})`, "#33ccff");
        } else {
            log("It's quiet. Too quiet. You find nothing of interest.");
        }
        updateUI();
    }

    function attack() {
        const damage = Math.floor(Math.random() * 7) - 3 + player.totalAttack; 
        currentEnemy.takeDamage(damage);
        log(`> You strike the ${currentEnemy.name} for ${damage} damage!`);

        if (!currentEnemy.isAlive()) {
            log(`You defeated the ${currentEnemy.name}!`, "#33ccff");
            player.gainXp(currentEnemy.xpReward);
            gameState = 'EXPLORE';
            currentEnemy = null;
            updateUI();
            return;
        }

        const eDamage = Math.floor(Math.random() * 5) - 2 + currentEnemy.baseAttack;
        const actualDamage = player.takeDamage(eDamage);
        log(`> The ${currentEnemy.name} attacks! You take ${actualDamage} damage!`, "#ff3333");

        if (!player.isAlive()) {
            log("*** YOU DIED! ***", "#ff0000");
            log("Game Over. Thanks for playing.");
        }
        updateUI();
    }

    function flee() {
        if (Math.random() > 0.5) {
            log("You successfully ran away!");
            gameState = 'EXPLORE';
            currentEnemy = null;
        } else {
            log("You tried to run, but couldn't escape!", "#ff3333");
            const eDamage = Math.floor(Math.random() * 5) - 2 + currentEnemy.baseAttack;
            const actualDamage = player.takeDamage(eDamage);
            log(`> The ${currentEnemy.name} strikes your back for ${actualDamage} damage!`, "#ff3333");
            if (!player.isAlive()) {
                log("*** YOU DIED! ***", "#ff0000");
            }
        }
        updateUI();
    }

    // ==========================================
    // INVENTORY MANAGEMENT
    // ==========================================
    function toggleInventory() {
        const panel = document.getElementById("inventory-panel");
        if (panel.style.display === "block") {
            panel.style.display = "none";
        } else {
            renderInventory();
            panel.style.display = "block";
        }
    }

    function renderInventory() {
        const list = document.getElementById("inventory-list");
        list.innerHTML = "";
        
        if (player.inventory.length === 0) {
            list.innerHTML = "<p>Your inventory is empty.</p>";
            return;
        }

        player.inventory.forEach((item, index) => {
            let stats = "";
            let actionText = "Use";
            if (item.type === 'weapon') { stats = `[+${item.power} ATK]`; actionText = "Equip"; }
            else if (item.type === 'armor') { stats = `[+${item.power} DEF]`; actionText = "Equip"; }
            else { stats = `[+${item.power} HP]`; }

            const div = document.createElement("div");
            div.className = "inv-item";
            div.innerHTML = `
                <span><strong>${item.name}</strong> ${stats} - ${item.desc}</span>
                <button class="inv-btn" onclick="useItem(${index})">${actionText}</button>
            `;
            list.appendChild(div);
        });
    }

    function useItem(index) {
        const item = player.inventory.splice(index, 1)[0]; 

        if (item.type === 'heal') {
            player.heal(item.power);
        } else if (item.type === 'weapon') {
            if (player.weapon) player.inventory.push(player.weapon); 
            player.weapon = item;
            log(`You equipped the ${item.name}!`);
        } else if (item.type === 'armor') {
            if (player.armor) player.inventory.push(player.armor);
            player.armor = item;
            log(`You equipped the ${item.name}!`);
        }
        
        updateUI();
        renderInventory(); 
    }

    // ==========================================
    // SAVE / LOAD SYSTEM
    // ==========================================
    function saveGame() {
        // Extract the exact current state of the player
        const saveData = {
            hp: player.hp,
            maxHp: player.maxHp,
            baseAttack: player.baseAttack,
            level: player.level,
            xp: player.xp,
            xpToLevel: player.xpToLevel,
            inventory: player.inventory,
            weapon: player.weapon,
            armor: player.armor
        };
        
        // Convert to a string and store it in the browser
        localStorage.setItem("wastelandRPG_save", JSON.stringify(saveData));
        log("Game saved successfully!", "#ffff33");
    }

    function loadGame() {
        const savedString = localStorage.getItem("wastelandRPG_save");
        
        if (savedString) {
            const saveData = JSON.parse(savedString);
            
            // Map the saved data back onto our player object
            player.hp = saveData.hp;
            player.maxHp = saveData.maxHp;
            player.baseAttack = saveData.baseAttack;
            player.level = saveData.level;
            player.xp = saveData.xp;
            player.xpToLevel = saveData.xpToLevel;
            player.inventory = saveData.inventory;
            player.weapon = saveData.weapon;
            player.armor = saveData.armor;
            
            log("Game loaded successfully!", "#ffff33");
            updateUI();
        } else {
            log("No save file found.", "#ff3333");
        }
    }

    // Initialize game
    log("Welcome to the Wasteland. Try to survive.");
    updateUI();
</script>

</body>
</html>
